This file provides guidance when working with code in this repository.

## Commands

```bash
# Development
pnpm run dev              # Start dev server
pnpm run build            # Production build (includes post generation)
pnpm run preview          # Preview production build

# Quality
pnpm run lint             # Prettier + ESLint check
pnpm run format           # Auto-format with Prettier
pnpm run check            # Svelte type checking
pnpm test                 # Playwright tests

# Issue tracking (beads)
bd ready                  # Find available work
bd show <id>              # View issue details
bd update <id> --status in_progress  # Claim work
bd close <id>             # Complete work
bd sync                   # Sync issues with git
```

## Architecture

This is a personal academic website built with **SvelteKit 2.x** and **Svelte 5**, deployed on **Vercel**.

### Dual Front Page Design

The site has two different homepage designs that are randomly served:

- `/1` - Classic academic/professional design (85% traffic)
- `/2` - SNES retro gaming theme (15% traffic)

The root route (`/`) performs a server-side redirect in `src/routes/+page.server.ts`. Each design has its own header component:

- `src/lib/header/Header.svelte` - Standard header with squiggly underline animation
- `src/lib/header/SNESHeader.svelte` - Retro pixel-style header

The `hideStandardHeader` store (`src/lib/stores/headerVisibility.ts`) controls which header displays.

### Key Sections

- **CV** (`/cv`) - Academic curriculum vitae with publications, grants, teaching. Data-driven from `src/lib/cv/` components and `src/routes/cv/cv.json`.
- **Hue Hunter** (`/huehunter`) - Installable PWA color guessing game. Game logic in `src/lib/huehunter/`, with persistent history via `guessHistoryStore.ts`.
- **Blog** (`/p`) - Markdown posts via mdsvex. Posts live in `src/posts/`, list generated by `scripts/generate-post-list.js` at build time.
  - Create a post by adding `src/posts/<slug>.md` or `src/posts/<slug>.svx` with frontmatter:
    - Required: `title: ...`, `date: 'YYYY-MM-DD'`, `description: ...`
    - Optional SEO fields: `image: /path-or-url`, `keywords: ...` or `tags: ...`, `modified: 'YYYY-MM-DD'` or `updated: 'YYYY-MM-DD'`
    - Fallbacks: missing `image` uses the default OG image; missing `modified/updated` falls back to `date`.
  - Filenames become the slug (`/p/<slug>`). Files starting with `_` are ignored.
  - Run `pnpm generate-posts` to refresh `src/lib/generated/posts.json` (also runs on `pnpm build`).
  - `/p` reads the JSON when present, and falls back to reading `src/posts/` in dev.
  - Metadata surfaces:
    - `/rss.xml` RSS 2.0 feed built from `posts.json`
    - `/llms.txt` LLM index with recent posts
    - `/p/<slug>.md` markdown mirror for each post
    - `/p/<slug>` renders SEO meta tags + JSON-LD (Schema.org BlogPosting)
  - Guardrails/tests:
    - `pnpm run validate-posts` checks frontmatter fields/format.
    - Playwright tests in `tests/post-meta.spec.js`, `tests/post-schema.spec.js`, `tests/post-markdown.spec.js`, `tests/rss.spec.js`, `tests/llms.spec.js`.

### UI Components

Uses shadcn-style components based on **bits-ui** located in `src/lib/components/ui/`. CSS uses **TailwindCSS** with custom theme variables defined in `tailwind.config.js` and `src/app.postcss`.

### API Routes

- `/api/random-color` - Returns random color data
- `/api/random-word` - Returns random unusual words

## Session Completion

Before ending a session, always:

1. Run `bd sync` to commit beads changes
2. Commit code changes
3. `git push` - work is not complete until pushed

## Grabbing a task

When grabbing a task from bd ready, do your work in a worktree if it's a more significant task. Small tasks don't need it. If you see a series of small tasks, do all of them.
